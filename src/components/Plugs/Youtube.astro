---
interface Props {
  video: string;
  title: string;
  thumbnail: string;
}

const { video, title, thumbnail } = Astro.props;
const src = `https://www.youtube-nocookie.com/embed/${video}`;
---

<div class="relative max-w-4xl mx-auto" data-youtube-container>
  <!-- Contenedor del iframe (inicialmente oculto) -->
  <div
    class="hidden youtube-container aspect-w-16 aspect-h-9 relative iframe-container"
    data-iframe-container
  >
    <iframe
      width="100%"
      height="450"
      src=""
      allow="autoplay; encrypted-media"
      allowfullscreen
      title={title}
      data-youtube-iframe></iframe>
  </div>

  <!-- Botón de activación con thumbnail -->
  <button
    class="block duration-300 bg-black youtube-container aspect-w-16 aspect-h-9 w-full group thumbnail-button"
    data-youtube-button
    data-src={src}
  >
    <span
      class="absolute top-0 left-0 right-0 z-50 p-3 font-sans text-lg font-medium text-left text-white duration-300 group-hover:opacity-100 opacity-0"
    >
      Click para activar el reproductor.
    </span>

    <div
      class="absolute inset-0 z-50 cursor-pointer flex justify-center items-center"
    >
      <svg
        class="relative w-16 h-16 duration-300 fill-white md:scale-125 group-hover:scale-100"
        stroke="currentColor"
        fill="currentColor"
        stroke-width="0"
        viewBox="0 0 1024 1024"
        height="1em"
        width="1em"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm144.1 454.9L437.7 677.8a8.02 8.02 0 0 1-12.7-6.5V353.7a8 8 0 0 1 12.7-6.5L656.1 506a7.9 7.9 0 0 1 0 12.9z"
        ></path>
      </svg>
    </div>

    <img
      src={thumbnail}
      alt={title}
      width="1280"
      height="720"
      class="pointer-events-none duration-300 opacity-80 group-hover:opacity-30"
    />
  </button>

  <a class="text-sm mt-6 " href=`https://www.youtube.com/watch?v=${video}` target="_blank">
    Fuente: {title}
  </a>
</div>

<script is:inline>
  (function () {
    const containers = document.querySelectorAll("[data-youtube-container]");

    containers.forEach((container) => {
      const button = container.querySelector("[data-youtube-button]");
      const iframeContainer = container.querySelector(
        "[data-iframe-container]",
      );
      const iframe = container.querySelector("[data-youtube-iframe]");
      const src = button.dataset.src;

      button.addEventListener("click", function () {
        // Cargar el src del iframe con autoplay
        iframe.src = src + "?autoplay=1";

        // Ocultar el botón y mostrar el iframe
        button.classList.add("hidden");
        button.classList.remove("block");
        iframeContainer.classList.remove("hidden");
        iframeContainer.classList.add("block");
      });
    });
  })();
</script>
